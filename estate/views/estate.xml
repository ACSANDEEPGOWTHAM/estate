<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <!-- View Search -->
        <record id="search_view_estate_parameter" model="ir.ui.view">
            <field name="name">Estate Parameter</field>
            <field name="model">estate.parameter.value</field>
            <field name="arch" type="xml">
                <search string="Parameter">
                    <group expand='1' string='Group by...'>
                        <filter name="group_parameter" string='Parameter' domain="[]" context="{'group_by' : 'parameter_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- View Tree: Estate Structure -->
        <record model="ir.ui.view" id="view_form_location_inherited">
            <field name="name">Location - Estate Extension</field>
            <field name="model">stock.location</field>
            <field name="inherit_id" ref="stock.view_location_form"/>
            <field name="arch" type="xml">
                <group string="Additional Information" position="after">
                    <group string="Estate Location Information">
                        <field name="estate_location"/>
                        <field name="estate_location_level"/>
                        <field name="estate_location_type"/>
                    </group>
                </group>
            </field>
        </record>

        <!-- View: Block -->
        <record id="view_tree_block_config" model="ir.ui.view">
            <field name="name">Block Configuration</field>
            <field name="model">estate.block.template</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <tree string="Estate Block"
                      default_order="complete_name"
                      colors="blue:usage=='view';darkred:usage=='internal'">
                    <field name="inherit_location_id"/>
                    <field name="complete_name"/>
                    <field name="estate_location_type"/>
                    <field name="estate_location_level"/>
                    <field name="usage"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>

        <record id="view_form_block_config" model="ir.ui.view">
            <field name="name">Block Configuration Form</field>
            <field name="model">estate.block.template</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <form string="Block">
                    <sheet>
                        <label for="name" class="oe_edit_only"/>
                        <h1><field name="name"/></h1>
                        <label for="location_id" class="oe_edit_only"/>
                        <h2><field name="location_id"/></h2>

                        <group string="Location">
                            <field name="estate_location" required="True"/>
                            <field name="estate_location_level" required="True"/>
                            <field name="estate_location_type" required="True"/>
                        </group>

                        <group string="Areal Statement" attrs="{'invisible': [('estate_location_type','=', 'nursery')]}">
                            <field name="planted_year_id"
                                   attrs="{'invisible': [('estate_location_level','in', ('1','2'))]}"/>
                            <field name="qty_tree"/>
                            <field name="qty_tree_immature"/>
                            <field name="qty_tree_mature_normal"/>
                            <field name="qty_tree_mature_abnormal"/>
                        </group>

                        <group string="Assets" attrs="{'invisible': [('estate_location_type','=', 'nursery')]}">
                            <field name="is_smallholder"/>
                            <field name="partner_id" attrs="{'invisible': [('is_smallholder','=', False)]}"/>
                            <field name="company_id" attrs="{'invisible': [('is_smallholder','=', True  )]}"/>
                        </group>

                        <field name="block_parameter_ids"
                               attrs="{'invisible': [('estate_location_level','in', ('1','2'))]}"/>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_block_parameter_tree">
            <field name="name">Block Parameter Tree</field>
            <field name="model">estate.block.parameter</field>
            <field name="priority" eval="1"/>
            <field name="arch" type="xml">
                <tree editable="True">
                    <field name="parameter_id"/>
                    <field name="parameter_value_id"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_parameter_config_tree">
            <field name="name">Block Parameter Config Tree</field>
            <field name="model">estate.parameter.value</field>
            <field name="priority" eval="1"/>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record id="view_activity_category_config_form" model="ir.ui.view">
            <field name="name">Activity Category Form</field>
            <field name="model">estate.activity.category</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="name"/>
                        <field name="parent_id"/>
                    </group>
                    <group>
                        <group name="detail" string="Detail">
                            <field name="code"/>
                            <field name="type"/>
                        </group>
                        <group name="account" string="Account">
                            <field name="activity_income_categ_id"/>
                            <field name="activity_expense_categ_id"/>
                        </group>
                    </group>
                    <group>
                        <field name="comment"/>
                    </group>
                </form>
            </field>
        </record>

        <record id="view_activity_config_form" model="ir.ui.view">
            <field name="name">Activity Form</field>
            <field name="model">estate.activity</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="name"/>
                        <field name="activity_category_id"/>
                    </group>
                    <group>
                        <group   name="detail" string="Detail">
                            <field name="code"/>
                        </group>
                        <group name="account" string="Account">
                            <field name="activity_income_id"/>
                            <field name="activity_expense_id"/>
                        </group>
                    </group>
                </form>
            </field>
        </record>

        <record id="view_activity_config_search" model="ir.ui.view">
            <field name="name">Activity Configuration (Search)</field>
            <field name="model">estate.activity</field>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
                <search string="Product">
                    <field name="name" string="Activity"
                           filter_domain="['|',('name','ilike',self),('code','ilike',self)]"/>
                    <field name="activity_category_id"
                            filter_domain="[('activity_category_id', 'ilike', self)]"/>
                    <filter name="filter_category" string="Category"
                            filter_domain="[('activity_category_id', 'child_of', self.name)]"/>
                    <group string="Group By">
                        <filter name="by_category" string="Category"
                                context="{'group_by': 'activity_category_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!--
        View Activity Config Tree. List of all activities (Default View for object estate.activity)
        -->
        <record id="view_activity_config_tree" model="ir.ui.view">
            <field name="name">Activity Configuration</field>
            <field name="model">estate.activity</field>
            <field name="priority">1</field>
            <field name="search_view_id" ref="view_activity_config_search"/>
            <field name="arch" type="xml">
                <tree string="Activity"> <!-- todo set color-->
                    <field name="activity_category_id" string="Category"/>
                    <field name="code"/>
                    <field name="name"/>
                    <field name="sequence" invisible="True"/>
                </tree>
            </field>
        </record>



        <record id="view_activity_config_tree_2" model="ir.ui.view">
            <field name="name">Activity Configuration</field>
            <field name="model">estate.activity</field>
            <field name="search_view_id" ref="view_activity_config_search"/>
            <field name="context" eval="{'search_default_filter_category': 1}"/>
            <field name="arch" type="xml">
                <tree string="Activity"> <!-- todo set color-->
                    <field name="activity_category_id" string="Category"/>
                    <field name="code"/>
                    <field name="name"/>
                    <field name="sequence" invisible="True"/>
                </tree>
            </field>
        </record>

        <!-- Action -->
        <record model="ir.actions.act_window" id="action_list_block_estate">
            <field name="name">Estate Structure (Block)</field>
            <field name="res_model">estate.block.template</field>
            <field name="domain">[('estate_location','=','True')]</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.act_window" id="action_list_activity_category_config">
            <field name="name">Category</field>
            <field name="res_model">estate.activity.category</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record id="action_list_activity_config" model="ir.actions.act_window">
            <field name="name">Activities</field>
            <field name="res_model">estate.activity</field>
            <field name="view_mode">tree,form</field>
        </record>
        
        <record model="ir.actions.act_window" id="action_list_parameter_config">
            <field name="name">Parameter</field>
            <field name="res_model">estate.parameter.value</field>
            <field name="priority">1</field>
            <field name="context">{"search_default_group_parameter": 1}</field>
            <field name="search_view_id" ref="search_view_estate_parameter"/>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- todo action open Activity By Category -->


        <!-- Menu -->
        <menuitem id="main_estate_menu" name="Plantation"/>

        <menuitem id="estate_config_menu" name="Configuration" parent="main_estate_menu" sequence="100"/>

        <menuitem id="estate_blocking_menu"
                  name="Estate"
                  parent="estate_config_menu"
                  groups="base.group_no_one"/>

        <menuitem id="estate_estate_block_menu" name="Block Structure"
                  parent="estate_blocking_menu"
                  action="action_list_block_estate"
                  groups="base.group_no_one"/>
        <menuitem id="estate_activity_category" name="Activity Category"
                  parent="estate_blocking_menu"
                  action="action_list_activity_category_config"
                  groups="base.group_no_one"/>
        <menuitem id="estate_activity" name="Activity"
                  parent="estate_blocking_menu"
                  action="action_list_activity_config"
                  groups="base.group_no_one"/>

        <menuitem id="estate_master_menu" name="Configuration"
                  parent="estate_config_menu"
                  groups="base.group_no_one"/>
        <menuitem id="estate_parameter_menu" name="Parameter"
                  parent="estate_master_menu"
                  action="action_list_parameter_config"
                  groups="base.group_no_one"/>
    </data>
</openerp>